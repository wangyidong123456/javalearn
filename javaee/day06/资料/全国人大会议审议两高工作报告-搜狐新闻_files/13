var UCS=UCS||{};(function(){var Log={info:function(e){try{console.log("info => "+e)}catch(e){}}};var configEle=document.getElementById("ucshare_config");var host=configEle.getAttribute("server");var appCenter=configEle.getAttribute("appCenter");var ccsServer=configEle.getAttribute("ccsServer");ccsServer=ccsServer||"http://ccs.ucweb.com/ccs/13?_e=1h&_t=";var acBookmark=appCenter+"/appstore/AppCenter/midpage?src=ucplus_platform&backurl={backurl}&uc_param_str=nieidnutssvebipfcp&api_ver=2.0&appid={appId}";var imagePath=host+"/public/img/";var iconCss="background:url("+imagePath+"uc_icon.png) -999px -999px no-repeat;";var ucshareLibrary=ccsServer+encodeURIComponent(host+"/public/js-min/ucshare_library_normal.js");Log.info("host="+host+", appCenter="+appCenter+",ccsServer="+ccsServer+",ucshareLibrary="+ucshareLibrary);var gen={genUrl:function(appid,openUrl){return acBookmark.replace("{backurl}",encodeURIComponent(openUrl)).replace("{appId}",appid)},genQRcode:function(url,logo,width){var saveE=UCS.genEle("div");saveE.style.cssText="width:"+width+"px;height:"+width+"px;position:relative;";if(logo!=null&&logo!=""){var css="position:absolute;left:"+0.4*width+"px;top:"+0.4*width+"px;width:"+0.2*width+"px;height:"+0.2*width+"px;";saveE.appendChild(UCS.genImg(css,logo))}if(UCS.genEle("canvas").getContext){saveE.appendChild(UCS.qrcode({text:url,width:width,height:width}))}else{var css="width:"+width+"px;height:"+width+"px;";var dynImgSrc=ccsServer+encodeURIComponent(host+"/dynQrcode?text="+encodeURIComponent(url));saveE.appendChild(UCS.genImg(css,dynImgSrc))}return{save:saveE}},genPanel:function(host,title,prompt,qrcode,width){width=parseInt(width);var font_size=parseInt(0.1*width-3),padding=parseInt(0.1*width-2);if(font_size<12){font_size=12}var fact_height=2*padding+10+width;var e=UCS.genEle("div");e.style.cssText="width:"+(width+10+2*padding)+"px;background:#FFFFFF;";var container=UCS.genEle("div");container.style.cssText="padding:"+padding+"px;";if(title!=null&&title!=""){var title_div=UCS.genEle("div");title_div.style.cssText="width:"+(width+10)+"px;height:20px;line-height:20px;font-size:"+font_size+'px;font-family:"宋体",Arial;font-weight:bold;text-align:center;overflow:hidden;';title_div.innerHTML=title;container.appendChild(title_div);fact_height+=20}var qrcode_div=UCS.genEle("div");qrcode_div.style.cssText="padding:5px;";qrcode_div.appendChild(qrcode.save);container.appendChild(qrcode_div);if(prompt!=null&&prompt!=""){var prompt_div=UCS.genEle("div");prompt_div.style.cssText="width:"+(width+10)+"px;height:22px;line-height:22px;font-size:"+font_size+'px;font-family:"宋体",Arial;font-weight:bold;text-align:center;overflow:hidden;';var box=UCS.genEle("b");box.style.cssText=iconCss+"width:18px;height:21px;margin-right:2px;cursor:pointer;display:inline-block; vertical-align:middle;background-position:0 -26px;";prompt_div.appendChild(box);var tip=UCS.genEle("b");tip.innerHTML=prompt;UCS.addEvent(box,"click",function(ev){if(box.className=="ucshare_unsave"){qrcode_div.removeChild(qrcode.unsave);qrcode_div.appendChild(qrcode.save);box.style.backgroundPosition="0 -26px";box.className="ucshare_save"}else{qrcode_div.removeChild(qrcode.save);qrcode_div.appendChild(qrcode.unsave);box.style.backgroundPosition="0 -1px";box.className="ucshare_unsave"}});prompt_div.appendChild(tip);container.appendChild(prompt_div);fact_height+=22}e.style.height=fact_height+"px";e.appendChild(container);UCS.addEvent(e,"click",UCS.stopPropagation);return e},genIcon:function(size){var e=UCS.genEle("div");var css=iconCss+"display:block;cursor:pointer;margin:0;";if(size==16){css+="width:16px;height:16px;background-position:0 -100px;"}else{if(size==24){css+="width:24px;height:24px;background-position:0 -124px;"}else{css+="width:32px;height:32px;background-position:0 -160px;"}}e.style.cssText=css;return e},genPopup:function(icon,panel,size){var width=parseInt(panel.style.width.replace("px",""));var height=parseInt(panel.style.height.replace("px",""));var e=UCS.genEle("div");e.style.cssText="display:none;";panel.style.cssText="position:absolute;border:1px solid #8C8C8C;box-shadow:0 0 13px rgba(0, 0, 0, 1);border-radius:2px;background:#FFFFFF;";e.appendChild(panel);var up_tri=UCS.genEle("div");up_tri.style.cssText=iconCss+"width:17px;height:10px;position:absolute;background-position:0 -78px;display:none;";e.appendChild(up_tri);var down_tri=UCS.genEle("div");down_tri.style.cssText=iconCss+"width:17px;height:10px;position:absolute;background-position:0 -60px;display:none;";e.appendChild(down_tri);UCS.addEvent(icon,"click",function(){if(e.style.display=="none"){var loc=UCS.getOffset(icon);var left=parseInt(loc.left-width/2+size/2),top=loc.top-height-12;var tri,tri_left=left+width/2-8,tri_top=top+height;if(top<0){tri=up_tri;top=loc.top+size+12;tri_top=top-8}else{tri=down_tri}tri.style.left=tri_left+"px";tri.style.top=tri_top+"px";tri.style.display="block";panel.style.left=left+"px";panel.style.top=top+"px";e.style.display="block"}else{e.style.display="none"}});return e}};var loadScript=function(url,callback){var script=document.createElement("script");script.type="text/javascript";script.src=url;document.getElementsByTagName("script")[0].parentNode.appendChild(script);if(script.readyState){script.onreadystatechange=function(){if(script.readyState=="loaded"||script.readyState=="complete"){script.onreadystatechange=null;callback()}}}else{script.onload=function(){callback()}}};loadScript(ucshareLibrary,function(){try{var ucshare_config=UCS.getById("ucshare_config");if(ucshare_config){ucshare_config.style.display="none"}else{return}var cnf=UCS.initConf(ucshare_config);if(cnf.appid==null||cnf.appid==""||cnf.width==null||cnf.width==""||isNaN(cnf.width)||parseInt(cnf.width)<=0){return}var qrcode,panel,url=gen.genUrl(cnf.appid,window.location.href);Log.info("gen url="+url);var ucshare_picture=UCS.getById("ucshare_picture");if(ucshare_picture){ucshare_picture.style.cssText=ucshare_picture.style.cssText+"display:inline-block;*display:inline;zoom:1;";qrcode=gen.genQRcode(url,cnf.logo,cnf.width);ucshare_picture.appendChild(qrcode.save)}var icon_ids={ucshare_popup_16:16,ucshare_popup_24:24,ucshare_popup_32:32};for(var icon_id in icon_ids){var icon=UCS.getById(icon_id);if(icon){var size=icon_ids[icon_id];icon.style.cssText=icon.style.cssText+"display:inline-block;*display:inline;zoom:1;width:"+size+"px;height:"+size+"px;";qrcode=gen.genQRcode(url,cnf.logo,cnf.width);panel=gen.genPanel(host,cnf.title,cnf.prompt,qrcode,cnf.width);icon.appendChild(gen.genPopup(icon,panel,size));icon.appendChild(gen.genIcon(size))}}}catch(err){if(console){console.error(err.name+":"+err.message)}}})}());